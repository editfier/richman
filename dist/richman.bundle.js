/*! For license information please see richman.bundle.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Richman=t():e.Richman=t()}(self,(()=>(()=>{var e={771:(e,t,i)=>{i(779),e.exports=function(e){"use strict";return e=e||{},'<canvas id="rich-man-role"></canvas>\r\n<canvas id="rich-man-build"></canvas>\r\n<canvas id="rich-man-map"></canvas>\r\n<div class="role-list">\r\n    <div class="role-list-info"></div>\r\n    <div class="role-control">\r\n        <div class="role-control-dice">掷色子</div>\r\n        <div class="role-control-buy">购买</div>\r\n        <div class="role-control-pack">背包</div>\r\n        <div class="role-control-jump">跳过</div>\r\n    </div>\r\n    <div id="role-current-time">*</div>\r\n</div>\r\n<div class="role-package" data-packname>\r\n    <div class="role-package-close">X</div>\r\n    <div class="role-package-list">\r\n    </div>\r\n</div>\r\n<div id="role-dice">\r\n    <div class="role-dice-list">\r\n        <div class="role-dice-delta">1</div>\r\n        <div class="role-dice-delta">2</div>\r\n        <div class="role-dice-delta">3</div>\r\n    </div>\r\n    <div class="role-dice-list">\r\n        <div class="role-dice-delta">8</div>\r\n        <div class="role-dice-delta"></div>\r\n        <div class="role-dice-delta">4</div>\r\n    </div>\r\n    <div class="role-dice-list">\r\n        <div class="role-dice-delta">7</div>\r\n        <div class="role-dice-delta">6</div>\r\n        <div class="role-dice-delta">5</div>\r\n    </div>\r\n</div>\r\n<div id="rich-man-talk"></div>'}},585:(e,t,i)=>{"use strict";var s="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:{},r=Object.create(s),l=/["&'<>]/;function a(e){return"string"!=typeof e&&(e=null==e?"":"function"==typeof e?a(e.call(e)):JSON.stringify(e)),e}r.$escape=function(e){return function(e){var t=""+e,i=l.exec(t);if(!i)return e;var s="",r=void 0,a=void 0,n=void 0;for(r=i.index,a=0;r<t.length;r++){switch(t.charCodeAt(r)){case 34:n="&#34;";break;case 38:n="&#38;";break;case 39:n="&#39;";break;case 60:n="&#60;";break;case 62:n="&#62;";break;default:continue}a!==r&&(s+=t.substring(a,r)),a=r+1,s+=n}return a!==r?s+t.substring(a,r):s}(a(e))},r.$each=function(e,t){if(Array.isArray(e))for(var i=0,s=e.length;i<s;i++)t(e[i],i);else for(var r in e)t(e[r],r)},e.exports=r},779:(e,t,i)=>{"use strict";e.exports=i(585)},861:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});var s=i(81),r=i.n(s),l=i(645),a=i.n(l)()(r());a.push([e.id,'*{margin:0;padding:0}body{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center}#rich-man-role,#rich-man-build,#rich-man-map{position:absolute}#rich-man-role{z-index:1}#rich-man-build{z-index:0}#rich-man-map{z-index:-1}.role-list{position:absolute;top:25%;left:50%;transform:translate(-50%, -25%);display:flex;flex-direction:column;border-radius:6px;background:rgba(255,255,255,.7);color:#57606f;z-index:2}.role-list::before,.role-list::after{content:"";border-radius:6px;border-bottom-left-radius:0;border-bottom-right-radius:0;width:100%;height:10px;display:block;background:#2ed573}.role-list::after{background:none}.role-list .role-list-title{margin-top:5px;margin-bottom:5px;display:flex;justify-content:center;letter-spacing:.2em;font-weight:bold}.role-list .role-list-item{display:flex;flex-direction:column}.role-list .role-list-item .role-item{width:300px;margin:5px;display:flex;flex-direction:row}.role-list .role-list-item .role-item *{flex:1;padding:5px}.role-list .role-list-item .role-item.role-item-active{background:#1e90ff;color:#fff;border-radius:6px}.role-list .role-control{display:flex;flex-direction:row;justify-content:space-evenly;margin-bottom:5px}.role-list .role-control *{padding:5px;color:#fff;border-radius:6px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}.role-list .role-control .role-control-dice{background:#ff4757}.role-list .role-control .role-control-buy{background:#3742fa}.role-list .role-control .role-control-jump{background:#ff6348}.role-list .role-control .role-control-pack{background:#1abc9c}.role-list .role-control *.disabled{background:#a4b0be;color:#dfe4ea}.role-list #role-current-time{display:flex;margin-top:5px;margin-bottom:5px;justify-content:center;font-size:24px}.role-package{position:absolute;width:200px;height:300px;background:#1e90ff;left:50%;top:40%;transform:translate(-50%, -50%);display:none;flex-direction:column;border-radius:5px;z-index:4}.role-package::before{position:absolute;content:attr(data-packname);display:block;font-size:14px;color:#fff;left:50%;transform:translate(-50%, 0)}.role-package .role-package-close{width:24px;height:24px;background:#1abc9c;display:flex;color:#fff;border-top-right-radius:5px;justify-content:center;align-items:center;align-self:flex-end;cursor:pointer}.role-package .role-package-list{flex:1;display:flex;flex-flow:wrap row;align-content:flex-start;background:#1abc9c;box-sizing:border-box}.role-package .role-package-list .role-package-item{display:flex;flex-direction:column;justify-content:space-between;width:33.3%;height:33.3%;font-size:12px;cursor:pointer}.role-package .role-package-list .role-package-item .role-package-name{text-align:center;background:#fff}.role-package .role-package-list .role-package-item .role-package-count{text-align:center;background:#fff}.role-package .role-package-list .role-package-item img{width:100%;height:65%}.role-package .role-package-list .role-package-item:hover{color:#daa520}#role-dice{position:absolute;left:50%;top:63%;transform:translate(-50%, -63%);display:flex;flex-direction:column;background:rgba(0,0,0,0);opacity:.95;z-index:3}#role-dice .role-dice-list{display:flex;flex-direction:row}#role-dice .role-dice-list:nth-child(2)>.role-dice-delta:nth-child(2){background:#1abc9c}#role-dice .role-dice-list:nth-child(1)>.role-dice-delta:nth-child(1){background:#c0392b}#role-dice .role-dice-list:nth-child(1)>.role-dice-delta:nth-child(1).active{background:#e74c3c}#role-dice .role-dice-list:nth-child(1)>.role-dice-delta:nth-child(2){background:#d35400}#role-dice .role-dice-list:nth-child(1)>.role-dice-delta:nth-child(2).active{background:#e67e22}#role-dice .role-dice-list:nth-child(1)>.role-dice-delta:nth-child(3){background:#f39c12}#role-dice .role-dice-list:nth-child(1)>.role-dice-delta:nth-child(3).active{background:#f1c40f}#role-dice .role-dice-list:nth-child(2)>.role-dice-delta:nth-child(1){background:#1abc9c}#role-dice .role-dice-list:nth-child(2)>.role-dice-delta:nth-child(1).active{background:#16a085}#role-dice .role-dice-list:nth-child(2)>.role-dice-delta:nth-child(2){background:rgba(0,0,0,0)}#role-dice .role-dice-list:nth-child(2)>.role-dice-delta:nth-child(3){background:#27ae60}#role-dice .role-dice-list:nth-child(2)>.role-dice-delta:nth-child(3).active{background:#2ecc71}#role-dice .role-dice-list:nth-child(3)>.role-dice-delta:nth-child(1){background:#8e44ad}#role-dice .role-dice-list:nth-child(3)>.role-dice-delta:nth-child(1).active{background:#9b59b6}#role-dice .role-dice-list:nth-child(3)>.role-dice-delta:nth-child(2){background:#f78fb3}#role-dice .role-dice-list:nth-child(3)>.role-dice-delta:nth-child(2).active{background:#f8a5c2}#role-dice .role-dice-list:nth-child(3)>.role-dice-delta:nth-child(3){background:#3dc1d3}#role-dice .role-dice-list:nth-child(3)>.role-dice-delta:nth-child(3).active{background:#63cdda}#role-dice .role-dice-list .role-dice-delta{width:32px;height:32px;border:solid 1px #bdc3c7;display:flex;color:#333;justify-content:center;align-items:center;font-size:12px;font-style:italic}#role-dice .role-dice-list .role-dice-delta.active{font-size:16px;color:#fff;font-weight:bold;font-style:normal}#rich-man-talk{-webkit-animation:shake 5s ease-in-out 5s infinite;animation:shake 5s ease-in-out 5s infinite;background-color:rgba(236,217,188,.9);border:1px solid #e0ba8c;border-radius:12px;box-shadow:0 3px 15px 2px rgba(191,158,118,.2);font-size:18px;line-height:24px;margin:-30px 0;min-height:70px;opacity:0;overflow:hidden;padding:5px 10px;position:absolute;left:50%;top:85%;transform:translate(-50%, -85%);text-overflow:ellipsis;transition:opacity 1s;width:250px;word-break:break-all;z-index:3}#rich-man-talk.active{opacity:1;transition:opacity .3s}#rich-man-talk.active span{color:#e84118}@-webkit-keyframes shake{25%{transform:translate(-50%, -85%) translate(0.5px, -1.5px) rotate(-2.5deg)}50%{transform:translate(-50%, -85%) translate(0.5px, -1px) rotate(2.5deg)}75%{transform:translate(-50%, -85%) translate(0.5px, -0.5px) rotate(-2.5deg)}0%,100%{transform:translate(-50%, -85%) translate(0.5px, 0.5px) rotate(0deg)}}@keyframes shake{25%{transform:translate(-50%, -85%) translate(0.5px, -1.5px) rotate(-2.5deg)}50%{transform:translate(-50%, -85%) translate(0.5px, -1px) rotate(2.5deg)}75%{transform:translate(-50%, -85%) translate(0.5px, -0.5px) rotate(-2.5deg)}0%,100%{transform:translate(-50%, -85%) translate(0.5px, 0.5px) rotate(0deg)}}',""]);const n=a},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",s=void 0!==t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),s&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),s&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,s,r,l){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(s)for(var n=0;n<this.length;n++){var o=this[n][0];null!=o&&(a[o]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);s&&a[h[0]]||(void 0!==l&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=l),i&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=i):h[2]=i),r&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=r):h[4]="".concat(r)),t.push(h))}},t}},81:e=>{"use strict";e.exports=function(e){return e[1]}},379:e=>{"use strict";var t=[];function i(e){for(var i=-1,s=0;s<t.length;s++)if(t[s].identifier===e){i=s;break}return i}function s(e,s){for(var l={},a=[],n=0;n<e.length;n++){var o=e[n],c=s.base?o[0]+s.base:o[0],h=l[c]||0,d="".concat(c," ").concat(h);l[c]=h+1;var m=i(d),u={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==m)t[m].references++,t[m].updater(u);else{var p=r(u,s);s.byIndex=n,t.splice(n,0,{identifier:d,updater:p,references:1})}a.push(d)}return a}function r(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var l=s(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<l.length;a++){var n=i(l[a]);t[n].references--}for(var o=s(e,r),c=0;c<l.length;c++){var h=i(l[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}l=o}}},569:e=>{"use strict";var t={};e.exports=function(e,i){var s=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,i)=>{"use strict";e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var r=void 0!==i.layer;r&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,r&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var l=i.sourceMap;l&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var l=t[s]={id:s,exports:{}};return e[s](l,l.exports,i),l.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})();var s={};return(()=>{"use strict";i.d(s,{default:()=>$});var e=i(379),t=i.n(e),r=i(795),l=i.n(r),a=i(569),n=i.n(a),o=i(565),c=i.n(o),h=i(216),d=i.n(h),m=i(589),u=i.n(m),p=i(861),f={};f.styleTagTransform=u(),f.setAttributes=c(),f.insert=n().bind(null,"head"),f.domAPI=l(),f.insertStyleElement=d(),t()(p.Z,f),p.Z&&p.Z.locals&&p.Z.locals;const b={ID:Symbol("id type"),CLASS:Symbol("class type")},g=[{name:"地狱边境",src:"https://img2.baidu.com/it/u=25899456,1478070957&fm=253&fmt=auto&app=138&f=JPEG?w=640&h=426",fontColor:"#fff",risk:!0},{name:"沙哈拉沙漠",money:3200,src:"https://img2.baidu.com/it/u=313102027,2756436313&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=234",fontColor:"#ee5253"},{name:"阿勒特平原",money:500,src:"https://img0.baidu.com/it/u=169361816,2366148185&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=313",fontColor:"#fff"},{name:"幻想乡",money:1e3,src:"https://img0.baidu.com/it/u=1605457923,1953811478&fm=26&fmt=auto",fontColor:"#fff",shop:!0},{name:"箱庭岛",money:400,src:"https://img2.baidu.com/it/u=4212837550,2437884169&fm=253&fmt=auto&app=138&f=JPEG?w=707&h=500",fontColor:"#fff"},{name:"彩虹岛",money:800,src:"https://img2.baidu.com/it/u=3962849056,819638092&fm=253&fmt=auto&app=138&f=JPEG?w=520&h=300",fontColor:"#ff9f43"},{name:"废气边陲",src:"https://img2.baidu.com/it/u=361930780,2040045157&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=296",risk:!0},{name:"夏洛特梦境",money:1500,src:"https://img1.baidu.com/it/u=2043835932,2902948496&fm=253&fmt=auto&app=138&f=JPEG?w=376&h=500",fontColor:"#f368e0"},{name:"蒸汽之都",money:3e3,src:"https://img1.baidu.com/it/u=3931350548,1754718168&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500"},{name:"英雄之村",money:2200,src:"https://img0.baidu.com/it/u=2753552073,1865783582&fm=26&fmt=auto"},{name:"遗落圣坛",money:1e3,src:"https://img2.baidu.com/it/u=4158053415,2142504387&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=320"},{name:"山海秘境",money:3e3,src:"https://img1.baidu.com/it/u=1844050364,530456280&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500"},{name:"血腥要塞",src:"https://img1.baidu.com/it/u=3886299193,3912689752&fm=253&fmt=auto&app=120&f=JPEG?w=820&h=546",fontColor:"#fff",risk:!0},{name:"星辰海",money:2500,src:"https://img1.baidu.com/it/u=2582105161,3093355499&fm=253&fmt=auto&app=120&f=JPEG?w=462&h=1000",fontColor:"#fff"},{name:"太空船废墟",money:1300,src:"https://img0.baidu.com/it/u=3964159907,1109195160&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=307"},{name:"圣者之塔",money:3e3,src:"https://img0.baidu.com/it/u=4041345951,3549347478&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=565",shop:!0},{name:"出云岛",money:1200,src:"https://img0.baidu.com/it/u=3248453462,3955837911&fm=253&fmt=auto&app=138&f=JPEG?w=658&h=411"},{name:"混沌深渊",money:1500,src:"https://img1.baidu.com/it/u=3615811170,235620978&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500"},{name:"第19区",src:"https://img1.baidu.com/it/u=2351069735,2607187122&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=281",risk:!0},{name:"德古拉城堡",money:1500,src:"https://img1.baidu.com/it/u=1678430886,2937951060&fm=253&fmt=auto&app=138&f=JPEG?w=499&h=281"},{name:"海盗港湾",money:2e3,src:"https://img0.baidu.com/it/u=3358634266,3942708847&fm=26&fmt=auto"},{name:"罗杰的宝藏",money:1200,src:"https://img2.baidu.com/it/u=1661012168,3108394996&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500"},{name:"元素洞窟",money:2500,src:"https://img0.baidu.com/it/u=4270821394,257579297&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=300"},{name:"古文明的遗迹",money:1700,src:"https://img1.baidu.com/it/u=3241632604,3561253008&fm=253&fmt=auto&app=138&f=JPEG?w=904&h=500"},{name:"混沌深渊",money:1700,src:"https://img2.baidu.com/it/u=3304027895,327882209&fm=253&fmt=auto&app=120&f=JPEG?w=887&h=800"}],y={TOP:Symbol("top align"),MIDDLE:Symbol("middle align"),BOTTOM:Symbol("bottom align")},v=i.p+"5a2a85ca4341349a5dbf0cb1645d56ff.mp3",k=[{name:"赌博卡",src:"https://img0.baidu.com/it/u=3925072505,3707939799&fm=253&fmt=auto&app=138&f=JPEG?w=476&h=500",num:1,type:1},{name:"重置卡",src:"https://img0.baidu.com/it/u=3925072505,3707939799&fm=253&fmt=auto&app=138&f=JPEG?w=476&h=500",num:1,type:2},{name:"转向卡",src:"https://img0.baidu.com/it/u=3925072505,3707939799&fm=253&fmt=auto&app=138&f=JPEG?w=476&h=500",num:1,type:3}];function x(e){const t=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(const i in e)e.hasOwnProperty(i)&&(e[i]&&"object"==typeof e[i]?t[i]=x(e[i]):t[i]=e[i]);return t}const w=Symbol(),E=Symbol();function T(e,t,i){let s,r,l=t/i-1;return e>=0&&e<=l-1?(s=0,r=e):e>=l&&e<=2*l-1?(s=e-l,r=l):e>=2*l&&e<=3*l-1?(s=l,r=3*l-e):e>=3*l&&e<=4*l-1&&(s=4*l-e,r=0),{x:r*i,y:s*i}}function _(e,t,i,s){let r=Math.floor(t/s),l=Math.floor(e/s),a=i/s-1,n=-1;return 0===r&&l>=0&&l<=a-1?n=l:l===a&&r>=0&&r<=a-1?n=l+r:r===a&&l>=1&&l<=a?n=3*a-l:0===l&&r>=1&&r<=a&&(n=4*a-r),n}const L=i.p+"ad9df481b5b5b1c35b17034f75467114.png",P=i.p+"77fc31e4dc8b484b08415609160a70eb.png",S=i.p+"ab0f6b8e775b6f4b73de740a37247868.png";function C(e,t){return Math.floor(Math.random()*(t-e+1))+e}const I=i(771),$=class{constructor(e){if(void 0===e)throw new Error("options is undefined");e.root.innerHTML=I(),this.template=new class{constructor(e){this.root=e,this.init()}set _root(e){this.root.style.position="relative",this.root.style.width=this.root.style.height=e+"px"}set _size(e){this.role.width=this.role.height=e,this.build.width=this.build.height=e,this.map.width=this.map.height=e}query(e,t,i){let s="";switch(i){case b.ID:s="#";break;case b.CLASS:s=".";break;default:throw new Error("type error")}return e.querySelector(`${s}${t}`)}init(){this.role=this.query(this.root,"rich-man-role",b.ID),this.build=this.query(this.root,"rich-man-build",b.ID),this.map=this.query(this.root,"rich-man-map",b.ID),this.info=this.query(this.root,"role-list-info",b.CLASS),this.diceControl=this.query(this.root,"role-control-dice",b.CLASS),this.buyControl=this.query(this.root,"role-control-buy",b.CLASS),this.jumpControl=this.query(this.root,"role-control-jump",b.CLASS),this.packControl=this.query(this.root,"role-control-pack",b.CLASS),this.roleTime=this.query(this.root,"role-current-time",b.ID),this.dice=this.query(this.root,"role-dice",b.ID),this.talk=this.query(this.root,"rich-man-talk",b.ID),this.packageList=this.query(this.root,"role-package",b.CLASS)}}(e.root),this.template._root=e.size,this.template._size=e.size,g.forEach((e=>{e.isBuy||(e.isBuy=!1),e.rate||(e.rate=.3),e.buyRole=-1})),this.map=new class{constructor(e,t,i){this.el=e,this.ctx=e.getContext("2d"),this.size=t,this.len=i,this.background("https://img2.baidu.com/it/u=2614772324,1063362496&fm=253&fmt=auto&app=138&f=JPEG?w=890&h=500"),this.render()}background(e){const t=new Image;t.onload=()=>{this.ctx.drawImage(t,this.len,this.len,this.size-2*this.len,this.size-2*this.len)},t.src=e}text(e,t,i,s,r,l){this.ctx.font=`${r}px 宋体 bold`,this.ctx.fillStyle=s;const a=this.ctx.measureText(e).width;switch(t+=(this.len-a)/2,l){case y.TOP:i+=r+r/2;break;case y.MIDDLE:i+=(this.len-r)/2;break;case y.BOTTOM:i+=this.len-r+r/2;break;default:throw new Error("text type error.")}this.ctx.fillText(e,t,i)}initImage(e){return new Promise((t=>{const i=new Image;i.onload=()=>{t(i)},i.src=e}))}async render(){let e=0,t=0;const i=this.size/this.len-1,s=4*i;for(let r=0;r<s;r++){let s=await this.initImage(g[r].src);this.ctx.drawImage(s,e,t,this.len,this.len),this.text(g[r].name,e,t,"#fff",16,y.MIDDLE),g[r].money&&this.text(g[r].money,e,t,"#fff",14,y.TOP),!0===g[r].risk&&this.text("无人区",e,t,"red",16,y.BOTTOM),g[r].shop&&this.text("道具城",e,t,"#fdcb6e",16,y.BOTTOM),r<i?e+=this.len:r<2*i?t+=this.len:r<3*i?e-=this.len:r<4*i&&(t-=this.len)}}}(this.template.map,e.size,e.len),this.role=new class{constructor(e,t,i,s,r){this.el=e,this.ctx=e.getContext("2d"),this.size=t,this.len=i,this[E]=[],this[w]=0,this.timer=null,this.init(s,r),this.render(),this.Audio=document.createElement("audio"),this.Audio.src=v}set _role(e){this[E]=e}get _role(){return this[E]}set _current(e){const t=this[E].length-1;if(e<0||e>t)throw new Error(`set current must be 0 ~ ${t}`);this[w]=e}get _current(){return this[w]}init(e,t){const i=this.len/2,s=this.len/2;for(let r=0;r<e.length;r++)this[E][r]={id:r,name:t[r],money:1e4,x:i,y:s,color:e[r],diceTime:1,jailTime:0,isBuyBuild:!1,package:x(k),usePackTime:3}}drawRole(e,t,i){this.ctx.beginPath(),this.ctx.fillStyle=e.color,this.ctx.arc(e.x,e.y,30,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=i,this.ctx.font=`${t}px 宋体 bold`;const s=this.ctx.measureText(`${e.id+1}`).width;this.ctx.fillText(e.id+1,e.x-(t-s)/2,e.y+t/2-t/5)}render(){let e=null;const t=this[E].length-1;this[E].forEach(((i,s)=>{s===this[w]&&(e=i),this.drawRole(i,24,"#666"),s===t&&this.drawRole(e,24,"#fff")}))}clear(){this.ctx.clearRect(0,0,this.size,this.size)}moveStep(e,t){const i=this[w];return new Promise((s=>{this.timer=setInterval((()=>{e-=1;let{x:r,y:l}=this.moveOneStep(this[E][i].x,this[E][i].y,t);this.Audio.play(),this[E][i].x=r,this[E][i].y=l,this.clear(),this.render(),0===e&&(clearInterval(this.timer),this.timer=null,s())}),150)}))}moveOneStep(e,t,i){const s=this.len/2,r=this.size-this.len-s,l=this.size-s;switch(void 0===i&&(i=!0),i){case!0:t===s&&e>=s&&e<=r?e+=this.len:e===l&&t>=s&&t<=r?t+=this.len:t===l&&e>=s+this.len&&e<=l?e-=this.len:e===s&&t>=s+this.len&&t<=l&&(t-=this.len);break;case!1:t===s&&e>=s+this.len&&e<=l?e-=this.len:e===l&&t>=s+this.len&&t<=l?t-=this.len:t===l&&e>=s&&e<=r?e+=this.len:e===s&&t>=s&&t<=r&&(t+=this.len)}return{x:e,y:t}}}(this.template.role,e.size,e.len,e.colors,e.names),this.build=new class{constructor(e,t,i,s,r){this.el=e,this.role=t,this.ctx=e.getContext("2d"),this.size=i,this.len=s,this.colors=r}rateToPath(e){let t=null;switch(e){case.3:t=L;break;case.6:t=P;break;case 1.2:t=S}return t}clearAll(){this.ctx.clearRect(0,0,this.size,this.size)}clear(e){let{x:t,y:i}=T(e,this.size,this.len);this.ctx.clearRect(t,i,this.len,this.len)}drawStar(e,t,i,s){this.ctx.beginPath();for(let r=0;r<5;r++)this.ctx.lineTo(Math.cos((18+72*r)/180*Math.PI)*t+i,-Math.sin((18+72*r)/180*Math.PI)*t+s),this.ctx.lineTo(Math.cos((54+72*r)/180*Math.PI)*e+i,-Math.sin((54+72*r)/180*Math.PI)*e+s);this.ctx.closePath(),this.ctx.fill()}initImage(e){return new Promise((t=>{const i=new Image;i.onload=()=>{t(i)},i.src=e}))}findIsBuy(){const e=[];for(let t=0;t<g.length;t++)!1!==g[t].isBuy&&e.push({place:g[t],index:t});return e}async render(){const e=this.findIsBuy();for(let t=0;t<e.length;t++){let i=this.role._role.findIndex((i=>i.id===e[t].place.buyRole)),s=this.rateToPath(e[t].place.rate);try{let r=await this.initImage(s),{x:l,y:a}=T(e[t].index,this.size,this.len);this.ctx.drawImage(r,l,a,this.len,this.len),this.ctx.fillStyle=this.role._role[i].color,this.drawStar(5,10,l+12,a+12),this.ctx.font="12px 宋体",this.ctx.fillStyle="white",this.ctx.fillText(`${e[t].place.buyRole+1}`,l+10,a+16)}catch(e){console.error(`build.js ${e}`)}}}}(this.template.build,this.role,e.size,e.len,e.colors),this.info=new class{constructor(e){this.el=e}render(e,t){if(0===e.length)return void(this.el.innerHTML='\n                <div class="role-list-title">暂无玩家</div>\n            ');this.el.innerHTML='\n            <div class="role-list-title">玩家信息</div>\n        ';let i=document.createElement("div");return i.className="role-list-item",e.forEach(((e,s)=>{let r=document.createElement("div");t===s?r.setAttribute("class","role-item role-item-active"):r.setAttribute("class","role-item");let l=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div");l.className="role-id",a.className="role-name",n.className="role-money",l.innerHTML=`${e.id+1}`,a.innerHTML=e.name,n.innerHTML=e.money,r.appendChild(l),r.appendChild(a),r.appendChild(n),i.appendChild(r)})),this.el.appendChild(i),this}}(this.template.info).render(this.role._role,this.role._current),this.timer=new class{constructor(e,t){this.el=e,this.role=t,this.renderTimer=null,this.waitTimer=null}render(e){this.el.innerHTML=e}nextRole(){const e=this.role._role.length-1;this.role._current<e?this.role._current++:this.role._current=0}clearTimer(){clearInterval(this.renderTimer),clearTimeout(this.waitTimer),this.renderTimer=null,this.waitTimer=null}waitCurrentRole(e){return new Promise((t=>{let i=e/1e3;this.renderTimer=setInterval((()=>{this.render(i),i-=1}),1e3),this.waitTimer=setTimeout((()=>{clearInterval(this.renderTimer),this.renderTimer=null,this.waitTimer=null,t()}),e)}))}}(this.template.roleTime,this.role),this.dice=new class{constructor(e){this.el=e,this.elDices=this.el.querySelectorAll(".role-dice-delta"),this.renderTimer=null,this.diceTimer=null,this.diceNumber=1}clearTimer(){clearInterval(this.renderTimer),clearTimeout(this.diceTimer),this.renderTimer=null,this.diceTimer=null}render(e){switch(this.elDices.forEach((e=>{e.classList.remove("active")})),e){case 1:case 2:case 3:this.elDices[e-1].classList.add("active");break;case 8:this.elDices[3].classList.add("active");break;case 4:this.elDices[5].classList.add("active");break;case 5:this.elDices[8].classList.add("active");break;case 6:this.elDices[7].classList.add("active");break;case 7:this.elDices[6].classList.add("active")}}playDice(e){return new Promise((t=>{this.renderTimer=setInterval((()=>{this.diceNumber<8?this.diceNumber++:this.diceNumber=1,this.render(this.diceNumber)}),100),this.diceTimer=setTimeout((()=>{clearInterval(this.renderTimer),this.renderTimer=null,this.diceTimer=null,t(this.diceNumber)}),e)}))}}(this.template.dice),this.talk=new class{constructor(e){this.el=e,this.talkTimer=null}message(e,t){this.talkTimer&&(clearTimeout(this.talkTimer),this.talkTimer=null),this.el.classList.add("active"),this.el.innerHTML=e,this.talkTimer=setTimeout((()=>{this.el.classList.remove("active")}),t)}}(this.template.talk),this.buy=new class{constructor(e,t,i,s){this.el=e,this.size=i,this.len=s,this.talk=t}buyBuild(e,t){let i=_(e[t].x,e[t].y,this.size,this.len);if(!0!==g[i].risk)if(!1===g[i].isBuy){if(g[i].money>e[t].money)return void this.talk.message(`<span>${e[t].name}</span>钱不够，无法购买`,4e3);g[i].isBuy=!0,g[i].buyRole=e[t].id,e[t].money-=g[i].money,this.talk.message(`\n            <span>${e[t].name}</span>购买了<span>${g[i].name}</span>，花费${g[i].money}\n        `,4e3)}else if(g[i].buyRole===e[t].id){const s=g[i].money*g[i].rate;if(s>e[t].money)return void this.talk.message(`<span>${e[t].name}</span>钱不够，无法升级`,4e3);g[i].rate<1?(e[t].money-=s,g[i].rate*=2,this.talk.message(`\n                        <span>${e[t].name}</span>升级了<span>${g[i].name}</span>，花费${s}，\n                         当前利率 <span>${g[i].rate}</span>\n                    `,4e3)):this.talk.message("再升级就要被世界政府制裁了",4e3)}}addPack(e,t,i,s,r,l,a){if(0===l)e[t].package[l]={name:i,src:s,num:a,type:r};else{let n=e[t].package.findIndex((e=>e.type===r));-1===n?e[t].package[l]={name:i,src:s,num:a,type:r}:e[t].package[n].num+=a}}riskEvent(e,t,i){if(0===C(0,1)){let s=C(-2e3,2e3);e[t].money+=s,s>0?this.talk.message(`\n                ${e[t].name}在<span>${g[i].name}</span>挖出了一笔财宝，+${s}\n            `,4e3):this.talk.message(`\n                ${e[t].name}在<span>${g[i].name}</span>遇到了盗贼，${s}\n            `,4e3)}else e[t].jailTime=1,this.talk.message(`\n            ${e[t].name}在<span>${g[i].name}</span>\n            被疯狂科学家抓去<span>实验</span>,下回合无法行动，\n            `,4e3)}watch(e,t){let i=_(e[t].x,e[t].y,this.size,this.len);if(!0!==g[i].risk){if(!0===g[i].shop){const i=k[C(0,k.length-1)],s=e[t].package.length,r=C(1,2);this.addPack(e,t,i.name,i.src,i.type,s,r)}if(!0===g[i].isBuy&&g[i].buyRole!==e[t].id){const s=g[i].money*g[i].rate;e[t].money-=s;const r=e.findIndex((e=>e.id===g[i].buyRole));e[r].money+=s,this.talk.message(`\n                    <span>${e[r].name}</span>收取了<span>${e[t].name}</span>，+${s}$\n                `,4e3)}}else this.riskEvent(e,t,i)}}(this.template.buy,this.talk,e.size,e.len),this.style=new class{constructor(e,t,i,s,r,l){this.size=r,this.len=l,this.diceEl=e,this.buyEl=t,this.jumpEl=i,this.packEl=s}setRemoveStyle(){this.diceEl.classList.add("disabled"),this.buyEl.classList.add("disabled"),this.jumpEl.classList.add("disabled"),this.packEl.classList.add("disabled")}controlStyle(e,t){let i=_(e[t].x,e[t].y,this.size,this.len);if(0===e[t].diceTime)if(this.diceEl.classList.add("disabled"),this.jumpEl.classList.remove("disabled"),!1===g[i].isBuy){if(!0===g[i].risk)return;e[t].isBuyBuild?this.buyEl.classList.remove("disabled"):this.buyEl.classList.add("disabled")}else e[t].id===g[i].buyRole&&(e[t].isBuyBuild?this.buyEl.classList.remove("disabled"):this.buyEl.classList.add("disabled"));else{if(this.diceEl.classList.remove("disabled"),this.jumpEl.classList.add("disabled"),this.buyEl.classList.add("disabled"),!0===g[i].risk)return;e[t].isBuyBuild?this.buyEl.classList.remove("disabled"):this.buyEl.classList.add("disabled")}0===e[t].package.length?this.packEl.classList.add("disabled"):this.packEl.classList.remove("disabled")}}(this.template.diceControl,this.template.buyControl,this.template.jumpControl,this.template.packControl,e.size,e.len),this.package=new class{constructor(e,t,i,s,r,l,a){this.packControl=e,this.packageEl=t,this.close=t.querySelector(".role-package-close"),this.packageList=t.querySelector(".role-package-list"),this.packageItem=[],this.bindSwitchEvents=[],this.role=i,this.info=s,this.style=r,this.talk=l,this.dice=a,this.bindEvent()}render(e,t){if(this.packageEl.style.display="flex",this.packageEl.setAttribute("data-packname",`${e[t].name}的背包`),this.packageList.innerHTML="",0!==e[t].package.length){if(0===e[t].usePackTime)return this.packageEl.style.display="none",void this.talk.message("使用<span>道具次数</span>达到上限",4e3);e[t].package.forEach((e=>{this.packageList.insertAdjacentHTML("beforeend",`\n                <div class="role-package-item">\n                    <div class="role-package-name">${e.name}</div>\n                    <img src="${e.src}" />\n                    <div class="role-package-count">${e.num}个</div>\n                </div>\n            `)})),this.packageItem=this.packageList.querySelectorAll(".role-package-item"),this.packageItem.forEach(((i,s)=>{this.bindSwitchEvents[s]=this.switchEvent.bind(this,s,e,t),i.addEventListener("click",this.bindSwitchEvents[s])}))}}switchEvent(e,t,i){switch(t[i].package[e].type){case 1:let s=C(-1e3,3e3);0===s?this.talk.message(`<span>${t[i].name}</span>去赌博了，啥也没赚，白忙活了`,4e3):s>0?this.talk.message(`<span>${t[i].name}</span>去赌博了，从现在开始这里叫${t[i].name}广场，+${s}$`,4e3):this.talk.message(`<span>${t[i].name}</span>去赌博了，被赶出了赌场，${s}$`,4e3),t[i].money+=s,t[i].package[e].num--,t[i].usePackTime--,this.info.render(t,i);break;case 2:null===this.role.timer&&(t[i].isBuyBuild=!0,this.style.controlStyle(t,i),t[i].package[e].num--,t[i].usePackTime--,this.talk.message(`<span>${t[i].name}</span>准备买买买`,4e3));break;case 3:if(null===this.role.timer){let s=C(1,8);this.role.moveStep(s,!1),t[i].package[e].num--,t[i].usePackTime--,this.talk.message(`<span>${t[i].name}</span>反向起飞了，现在开始一次不死，并且超神`,4e3)}}0===t[i].package[e].num&&(t[i].package[e]=null,t[i].package=t[i].package.filter((e=>null!==e))),this.render(t,i)}bindEvent(){this.close.addEventListener("click",(()=>{this.packageEl.style.display="none"}))}}(this.template.packControl,this.template.packageList,this.role,this.info,this.style,this.talk,this.dice),this.richMan=null,this.isNextRole=!0,this.bindDiceEvent=this.diceEvent.bind(this),this.bindBuyEvent=this.buyEvent.bind(this),this.bindJumpEvent=this.jumpEvent.bind(this),this.bindPackEvent=this.packEvent.bind(this),this.start(),this.bindEvents()}start(){this.richMan=setInterval((()=>{this.waitRoleTime(),this.style.controlStyle(this.role._role,this.role._current),this.isCurrentRoleDead(),1===this.role._role.length&&(this.dice.clearTimer(),this.timer.clearTimer(),this.removeEvents(),this.style.setRemoveStyle(),clearInterval(this.richMan),this.richMan=null,alert("Win"))}),30)}clearPlace(){return new Promise((e=>{g.forEach(((e,t)=>{e.buyRole===this.role._role[this.role._current].id&&(e.buyRole=-1,e.isBuy=!1,e.rate=.3)})),e()}))}async isCurrentRoleDead(){if(this.role._role[this.role._current].money<=0){this.dice.clearTimer(),this.timer.clearTimer(),await this.clearPlace(),this.build.clearAll();let e=this.role._role.length-1;this.role._role[this.role._current]=null,this.role._role=this.role._role.filter((e=>null!==e)),this.role._current===e&&(this.role._current=0),this.info.render(this.role._role,this.role._current),this.isNextRole=!0,this.role._role[this.role._current].isBuyBuild=!1,this.role.clear(),this.role.render(),await this.build.render()}}setRoleCurrent(e){this.role._current=e}async waitRoleTime(){if(this.isNextRole){if(this.isNextRole=!1,0===this.role._role[this.role._current].jailTime){if(await this.timer.waitCurrentRole(2e4),this.package.packageEl.style.display="none",this.role._role[this.role._current].diceTime){this.removeEvents(),this.role._role[this.role._current].diceTime=0;let e=await this.dice.playDice(1e3);await this.role.moveStep(e),this.addEvents()}}else this.role._role[this.role._current].jailTime--,this.talk.message(`<span>${this.role._role[this.role._current].name}</span>即将出狱`,4e3);this.nextSettings()}}nextSettings(){this.role._role[this.role._current].diceTime=1,this.timer.nextRole(),this.info.render(this.role._role,this.role._current),this.isNextRole=!0,this.role._role[this.role._current].isBuyBuild=!1,this.role._role[this.role._current].usePackTime=3,this.role.render()}async diceEvent(){if(0===this.role._role[this.role._current].diceTime)return;this.role._role[this.role._current].diceTime--,this.removeEvents();let e=C(100,1e3),t=await this.dice.playDice(e);await this.role.moveStep(t),this.buy.watch(this.role._role,this.role._current),this.info.render(this.role._role,this.role._current),this.addEvents(),this.role._role[this.role._current].isBuyBuild=!0}buyEvent(){!0===this.role._role[this.role._current].isBuyBuild&&(this.buy.buyBuild(this.role._role,this.role._current),this.build.clearAll(),this.build.render(),this.info.render(this.role._role,this.role._current),this.role._role[this.role._current].isBuyBuild=!1)}packEvent(){0!==this.role._role[this.role._current].package.length&&this.package.render(this.role._role,this.role._current)}addEvents(){this.template.diceControl.addEventListener("click",this.bindDiceEvent),this.template.buyControl.addEventListener("click",this.bindBuyEvent),this.template.jumpControl.addEventListener("click",this.bindJumpEvent),this.template.packControl.addEventListener("click",this.bindPackEvent)}removeEvents(){this.template.diceControl.removeEventListener("click",this.bindDiceEvent),this.template.buyControl.removeEventListener("click",this.bindBuyEvent),this.template.jumpControl.removeEventListener("click",this.bindJumpEvent),this.template.packControl.removeEventListener("click",this.bindPackEvent)}jumpEvent(){0===this.role._role[this.role._current].diceTime&&(this.dice.clearTimer(),this.timer.clearTimer(),this.nextSettings())}bindEvents(){this.addEvents()}}})(),s.default})()));